<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Superadmin Dashboard</title>
  <script src="https://cdn.tailwindcss.com"></script>
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600;700&display=swap" rel="stylesheet">
  <script src="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/js/all.min.js"></script>
  <style>
    body { font-family: 'Inter', sans-serif; }
    .sidebar { transition: transform 0.3s ease; }
    .sidebar-hidden { transform: translateX(-100%); }
    .card { @apply bg-white rounded-2xl shadow-lg p-6 transition hover:shadow-xl; }
    .status-badge { padding: 0.25rem 0.75rem; border-radius: 9999px; font-size: 0.75rem; font-weight: 600; }
    .approve-btn, .reject-btn { padding: 0.5rem 1rem; border-radius: 9999px; font-weight: 600; display: inline-flex; align-items: center; gap: 0.4rem; }
    .approve-btn { background-color: #10b981; color: white; }
    .approve-btn:hover { background-color: #059669; }
    .reject-btn { background-color: #ef4444; color: white; }
    .reject-btn:hover { background-color: #dc2626; }
  </style>
</head>
<body class="bg-gray-100">

<div class="flex h-screen overflow-hidden">
  <!-- Sidebar -->
  <aside id="sidebar" class="sidebar fixed inset-y-0 left-0 w-64 bg-gradient-to-b from-gray-900 to-gray-800 text-white p-4 z-40 sidebar-hidden md:relative md:translate-x-0">
    <div class="flex items-center justify-between mb-6">
      <h2 class="text-xl font-bold flex items-center gap-2"><i class="fas fa-user-shield text-blue-400"></i> Admin Panel</h2>
      <button id="closeSidebar" class="md:hidden"><i class="fas fa-times"></i></button>
    </div>
    <nav>
      <ul class="space-y-2">
        <li id="dashboardNav" class="flex items-center gap-2 p-2 rounded hover:bg-gray-700 cursor-pointer"><i class="fas fa-home"></i> Dashboard</li>
        <li id="studentsNav" class="flex items-center gap-2 p-2 rounded hover:bg-gray-700 cursor-pointer"><i class="fas fa-user-graduate"></i> Students</li>
        <li id="recruitersNav" class="flex items-center gap-2 p-2 rounded hover:bg-gray-700 cursor-pointer"><i class="fas fa-building"></i> Recruiters</li>
        <li id="applicationsNav" class="flex items-center gap-2 p-2 rounded hover:bg-gray-700 cursor-pointer"><i class="fas fa-file-alt"></i> Applications</li>
        <li id="jobsNav" class="flex items-center gap-2 p-2 rounded hover:bg-gray-700 cursor-pointer"><i class="fas fa-briefcase"></i> Jobs</li>
        <li id="notificationsNav" class="flex items-center gap-2 p-2 rounded hover:bg-gray-700 cursor-pointer"><i class="fas fa-bell"></i> Notifications</li>
        <li id="logoutNav" class="flex items-center gap-2 p-2 rounded hover:bg-gray-700 cursor-pointer"><i class="fas fa-sign-out-alt"></i> Logout</li>
      </ul>
    </nav>
  </aside>

  <!-- Main -->
  <div class="flex-1 flex flex-col">
    <!-- Header -->
    <header class="flex items-center justify-between bg-white shadow p-4">
      <button id="openSidebar" class="md:hidden text-gray-700"><i class="fas fa-bars"></i></button>
      <h1 class="text-xl font-bold">Superadmin Dashboard</h1>
    </header>

    <!-- Content -->
    <main class="flex-1 overflow-y-auto p-6 space-y-8">

      <!-- Dashboard -->
      <section id="dashboardSection">
        <div class="grid grid-cols-1 md:grid-cols-3 gap-6">
          <div class="card bg-gradient-to-r from-blue-500 to-blue-600 text-white">
            <h3 class="font-semibold">Total Students</h3>
            <p id="studentCount" class="text-3xl font-bold mt-2">0</p>
            <i class="fas fa-user-graduate text-3xl mt-3 opacity-80"></i>
          </div>
          <div class="card bg-gradient-to-r from-green-500 to-green-600 text-white">
            <h3 class="font-semibold">Total Recruiters</h3>
            <p id="recruiterCount" class="text-3xl font-bold mt-2">0</p>
            <i class="fas fa-building text-3xl mt-3 opacity-80"></i>
          </div>
          <div class="card bg-gradient-to-r from-yellow-500 to-yellow-600 text-white">
            <h3 class="font-semibold">Pending Approvals</h3>
            <p id="pendingCount" class="text-3xl font-bold mt-2">0</p>
            <i class="fas fa-hourglass-half text-3xl mt-3 opacity-80"></i>
          </div>
        </div>
      </section>

      <!-- Students -->
      <section id="studentsSection" class="hidden">
        <h2 class="text-2xl font-bold mb-4 flex items-center gap-2"><i class="fas fa-user-graduate"></i> Manage Students</h2>
        <div class="overflow-x-auto card">
          <table class="min-w-full divide-y divide-gray-200">
            <thead class="bg-gray-100"><tr>
              <th class="px-6 py-3 text-left">Name</th>
              <th class="px-6 py-3 text-left">Email</th>
              <th class="px-6 py-3 text-left">Status</th>
              <th class="px-6 py-3 text-left">Actions</th>
            </tr></thead>
            <tbody id="studentsTable" class="divide-y divide-gray-200"></tbody>
          </table>
        </div>
      </section>

      <!-- Recruiters -->
      <section id="recruitersSection" class="hidden">
        <h2 class="text-2xl font-bold mb-4 flex items-center gap-2"><i class="fas fa-building"></i> Manage Recruiters</h2>
        <div class="overflow-x-auto card">
          <table class="min-w-full divide-y divide-gray-200">
            <thead class="bg-gray-100"><tr>
              <th class="px-6 py-3 text-left">Company</th>
              <th class="px-6 py-3 text-left">Recruiter</th>
              <th class="px-6 py-3 text-left">Email</th>
              <th class="px-6 py-3 text-left">Status</th>
              <th class="px-6 py-3 text-left">Actions</th>
            </tr></thead>
            <tbody id="recruitersTable" class="divide-y divide-gray-200"></tbody>
          </table>
        </div>
      </section>

      <!-- Applications -->
      <section id="applicationsSection" class="hidden">
        <h2 class="text-2xl font-bold mb-4 flex items-center gap-2"><i class="fas fa-file-alt"></i> Student Applications</h2>
        <div class="overflow-x-auto card">
          <table class="min-w-full divide-y divide-gray-200">
            <thead class="bg-gray-100"><tr>
              <th class="px-6 py-3">Student</th>
              <th class="px-6 py-3">Job</th>
              <th class="px-6 py-3">Company</th>
              <th class="px-6 py-3">Applied On</th>
              <th class="px-6 py-3">Status</th>
            </tr></thead>
            <tbody id="applicationsTable" class="divide-y divide-gray-200"></tbody>
          </table>
        </div>
      </section>

      <!-- Jobs -->
      <section id="jobsSection" class="hidden">
        <h2 class="text-2xl font-bold mb-4 flex items-center gap-2"><i class="fas fa-briefcase"></i> Jobs Posted</h2>
        <div class="overflow-x-auto card">
          <table class="min-w-full divide-y divide-gray-200">
            <thead class="bg-gray-100"><tr>
              <th class="px-6 py-3">Company</th>
              <th class="px-6 py-3">Title</th>
              <th class="px-6 py-3">Posted</th>
              <th class="px-6 py-3">Deadline</th>
            </tr></thead>
            <tbody id="jobsTable" class="divide-y divide-gray-200"></tbody>
          </table>
        </div>
      </section>

      <!-- Notifications -->
      <section id="notificationsSection" class="hidden">
        <h2 class="text-2xl font-bold mb-4 flex items-center gap-2"><i class="fas fa-bell"></i> Manage Notifications</h2>
        <form id="notificationForm" class="mb-6 flex gap-4">
          <input id="notificationInput" type="text" placeholder="Write a notification..." class="flex-1 border rounded px-4 py-2" required/>
          <button class="bg-blue-600 text-white px-4 py-2 rounded"><i class="fas fa-plus"></i> Add</button>
        </form>
        <div class="overflow-x-auto card">
          <table class="min-w-full divide-y divide-gray-200">
            <thead class="bg-gray-100"><tr><th class="px-6 py-3">Message</th><th class="px-6 py-3">Date</th></tr></thead>
            <tbody id="notificationsTable" class="divide-y divide-gray-200"></tbody>
          </table>
        </div>
      </section>

    </main>
  </div>
</div>

<!-- Firebase SDK -->
<script type="module">
  import { initializeApp } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-app.js";
  import { getAuth, signOut } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-auth.js";
  import { getFirestore, doc, onSnapshot, updateDoc, collection, query, where, addDoc, serverTimestamp } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-firestore.js";
  import { firebaseConfig, appId } from "./firebase-config.js";

  const app = initializeApp(firebaseConfig);
  const auth = getAuth(app);
  const db = getFirestore(app);

  // Sidebar toggle
  const sidebar=document.getElementById('sidebar');
  document.getElementById('openSidebar').addEventListener('click',()=>sidebar.classList.remove('sidebar-hidden'));
  document.getElementById('closeSidebar').addEventListener('click',()=>sidebar.classList.add('sidebar-hidden'));

  // Nav links
  const sections={dashboardNav:'dashboardSection',studentsNav:'studentsSection',recruitersNav:'recruitersSection',applicationsNav:'applicationsSection',jobsNav:'jobsSection',notificationsNav:'notificationsSection'};
  Object.keys(sections).forEach(navId=>{document.getElementById(navId).addEventListener('click',()=>{Object.values(sections).forEach(secId=>document.getElementById(secId).classList.add('hidden'));document.getElementById(sections[navId]).classList.remove('hidden');sidebar.classList.add('sidebar-hidden');});});

  // Realtime counts
  const studentCountEl=document.getElementById("studentCount"),recruiterCountEl=document.getElementById("recruiterCount"),pendingCountEl=document.getElementById("pendingCount");
  onSnapshot(collection(db,"artifacts",appId,"users"),qs=>{let s=0,r=0,p=0;qs.forEach(d=>{const u=d.data();if(u.role==="student"){s++;if(u.approvalStatus==="pending")p++;}else if(u.role==="recruiter"){r++;if(u.approvalStatus==="pending")p++;}});studentCountEl.textContent=s;recruiterCountEl.textContent=r;pendingCountEl.textContent=p;});

  // Students table
  const studentsTable=document.getElementById("studentsTable");
  onSnapshot(query(collection(db,"artifacts",appId,"users"),where("role","==","student")),(qs)=>{studentsTable.innerHTML="";qs.forEach(docSnap=>{const st=docSnap.data();const badge=st.approvalStatus==="approved"?"bg-green-100 text-green-800":st.approvalStatus==="pending"?"bg-yellow-100 text-yellow-800":"bg-red-100 text-red-800";const act=st.approvalStatus==="pending"?`<button onclick="updateStudentStatus('${docSnap.id}','approved')" class="approve-btn"><i class="fas fa-check"></i> Approve</button> <button onclick="updateStudentStatus('${docSnap.id}','rejected')" class="reject-btn"><i class="fas fa-times"></i> Reject</button>`:"";studentsTable.innerHTML+=`<tr><td class="px-6 py-3">${st.name||"N/A"}</td><td class="px-6 py-3">${st.email||"N/A"}</td><td class="px-6 py-3"><span class="status-badge ${badge}">${st.approvalStatus}</span></td><td class="px-6 py-3">${act}</td></tr>`;});});

  // Recruiters table
  const recruitersTable=document.getElementById("recruitersTable");
  onSnapshot(query(collection(db,"artifacts",appId,"users"),where("role","==","recruiter")),(qs)=>{recruitersTable.innerHTML="";qs.forEach(docSnap=>{const rc=docSnap.data();const badge=rc.approvalStatus==="approved"?"bg-green-100 text-green-800":rc.approvalStatus==="pending"?"bg-yellow-100 text-yellow-800":"bg-red-100 text-red-800";const act=rc.approvalStatus==="pending"?`<button onclick="updateRecruiterStatus('${docSnap.id}','approved')" class="approve-btn"><i class="fas fa-check"></i> Approve</button> <button onclick="updateRecruiterStatus('${docSnap.id}','rejected')" class="reject-btn"><i class="fas fa-times"></i> Reject</button>`:"";recruitersTable.innerHTML+=`<tr><td class="px-6 py-3">${rc.companyName||"N/A"}</td><td class="px-6 py-3">${rc.name||"N/A"}</td><td class="px-6 py-3">${rc.email||"N/A"}</td><td class="px-6 py-3"><span class="status-badge ${badge}">${rc.approvalStatus}</span></td><td class="px-6 py-3">${act}</td></tr>`;});});

  // Applications table (LIVE student job applications)
  const applicationsTable=document.getElementById("applicationsTable");
  onSnapshot(collection(db,"artifacts",appId,"applications"),(qs)=>{applicationsTable.innerHTML="";qs.forEach(d=>{const ap=d.data();applicationsTable.innerHTML+=`<tr><td class="px-6 py-3">${ap.studentName||"N/A"}</td><td class="px-6 py-3">${ap.jobTitle||"N/A"}</td><td class="px-6 py-3">${ap.companyName||"N/A"}</td><td class="px-6 py-3">${ap.appliedAt?.toDate().toLocaleDateString()||"N/A"}</td><td class="px-6 py-3">${ap.status||"N/A"}</td></tr>`;});});

  // Jobs table (LIVE recruiter job postings)
  const jobsTable=document.getElementById("jobsTable");
  onSnapshot(collection(db,"artifacts",appId,"jobs"),(qs)=>{jobsTable.innerHTML="";qs.forEach(d=>{const jb=d.data();jobsTable.innerHTML+=`<tr><td class="px-6 py-3">${jb.companyName||"N/A"}</td><td class="px-6 py-3">${jb.title||"N/A"}</td><td class="px-6 py-3">${jb.postedAt?.toDate().toLocaleDateString()||"N/A"}</td><td class="px-6 py-3">${jb.deadline?.toDate().toLocaleDateString()||"N/A"}</td></tr>`;});});

  // Notifications table
  const notificationsTable=document.getElementById("notificationsTable");
  onSnapshot(collection(db,"artifacts",appId,"notifications"),(qs)=>{notificationsTable.innerHTML="";qs.forEach(d=>{const n=d.data();notificationsTable.innerHTML+=`<tr><td class="px-6 py-3">${n.message}</td><td class="px-6 py-3">${n.createdAt?.toDate().toLocaleString()||"N/A"}</td></tr>`;});});

  // Add notification
  document.getElementById('notificationForm').addEventListener('submit',async(e)=>{e.preventDefault();const msg=document.getElementById('notificationInput').value;await addDoc(collection(db,"artifacts",appId,"notifications"),{message:msg,createdAt:serverTimestamp()});document.getElementById('notificationInput').value="";});

  // Push notification helper
  async function pushNotification(msg){await addDoc(collection(db,"artifacts",appId,"notifications"),{message:msg,createdAt:serverTimestamp()});}

  // Approve/reject actions
  window.updateStudentStatus=async(id,status)=>{await updateDoc(doc(db,"artifacts",appId,"users",id),{approvalStatus:status});await pushNotification(`Student ${status}: ${id}`);}
  window.updateRecruiterStatus=async(id,status)=>{await updateDoc(doc(db,"artifacts",appId,"users",id),{approvalStatus:status});await pushNotification(`Recruiter ${status}: ${id}`);}

  // Logout
  document.getElementById('logoutNav').addEventListener('click',async()=>{await signOut(auth);location.href="superadmin-login.html";});
</script>
</body>
</html>
