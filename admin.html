<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Superadmin Dashboard</title>
  <script src="https://cdn.tailwindcss.com"></script>
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap" rel="stylesheet">
  <script src="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0-beta3/js/all.min.js"></script>
  <style>
    body { font-family: 'Inter', sans-serif; }
    .sidebar { transition: transform 0.3s ease; }
    .sidebar-hidden { transform: translateX(-100%); }
    .status-badge { padding: 0.25rem 0.75rem; border-radius: 9999px; font-size: 0.75rem; font-weight: 600; }
    .approve-btn, .reject-btn { padding: 0.5rem 1rem; border-radius: 0.5rem; font-weight: 600; transition: background-color 0.2s; }
    .approve-btn { background-color: #10b981; color: white; }
    .approve-btn:hover { background-color: #059669; }
    .reject-btn { background-color: #ef4444; color: white; }
    .reject-btn:hover { background-color: #dc2626; }
  </style>
</head>
<body class="bg-gray-100">

<div class="flex h-screen overflow-hidden">
  <!-- Sidebar -->
  <aside id="sidebar" class="sidebar fixed inset-y-0 left-0 w-64 bg-gray-900 text-white p-4 z-40 md:translate-x-0 sidebar-hidden md:relative md:sidebar-hidden md:translate-x-0">
    <div class="flex items-center justify-between mb-6">
      <h2 class="text-xl font-bold">Admin Panel</h2>
      <button id="closeSidebar" class="md:hidden"><i class="fas fa-times"></i></button>
    </div>
    <nav>
      <ul>
        <li id="dashboardNav" class="p-2 rounded hover:bg-gray-700 cursor-pointer">Dashboard</li>
        <li id="studentsNav" class="p-2 rounded hover:bg-gray-700 cursor-pointer">Manage Students</li>
        <li id="recruitersNav" class="p-2 rounded hover:bg-gray-700 cursor-pointer">Manage Recruiters</li>
        <li id="applicationsNav" class="p-2 rounded hover:bg-gray-700 cursor-pointer">View Applications</li>
        <li id="jobsNav" class="p-2 rounded hover:bg-gray-700 cursor-pointer">View Jobs</li>
        <li id="notificationsNav" class="p-2 rounded hover:bg-gray-700 cursor-pointer">Notifications</li>
        <li id="logoutNav" class="p-2 rounded hover:bg-gray-700 cursor-pointer">Logout</li>
      </ul>
    </nav>
  </aside>

  <!-- Main content -->
  <div class="flex-1 flex flex-col">
    <!-- Header -->
    <header class="flex items-center justify-between bg-white shadow p-4">
      <button id="openSidebar" class="md:hidden text-gray-700"><i class="fas fa-bars"></i></button>
      <h1 class="text-xl font-bold">Superadmin Dashboard</h1>
    </header>

    <!-- Sections -->
    <main class="flex-1 overflow-y-auto p-6 space-y-8">
      
      <!-- Dashboard -->
      <section id="dashboardSection">
        <div class="grid grid-cols-1 md:grid-cols-3 gap-6">
          <div class="bg-white shadow rounded p-6">
            <h3 class="font-semibold text-gray-700">Total Students</h3>
            <p id="studentCount" class="text-3xl font-bold mt-2">0</p>
          </div>
          <div class="bg-white shadow rounded p-6">
            <h3 class="font-semibold text-gray-700">Total Recruiters</h3>
            <p id="recruiterCount" class="text-3xl font-bold mt-2">0</p>
          </div>
          <div class="bg-white shadow rounded p-6">
            <h3 class="font-semibold text-gray-700">Pending Approvals</h3>
            <p id="pendingCount" class="text-3xl font-bold mt-2">0</p>
          </div>
        </div>
      </section>

      <!-- Manage Students -->
      <section id="studentsSection" class="hidden">
        <h2 class="text-2xl font-bold mb-4">Manage Students</h2>
        <div class="overflow-x-auto bg-white shadow rounded">
          <table class="min-w-full divide-y divide-gray-200">
            <thead class="bg-gray-50"><tr>
              <th class="px-6 py-3">Name</th><th class="px-6 py-3">Email</th><th class="px-6 py-3">Reg Date</th>
              <th class="px-6 py-3">Status</th><th class="px-6 py-3">Actions</th></tr>
            </thead>
            <tbody id="studentsTable" class="divide-y divide-gray-200"></tbody>
          </table>
        </div>
      </section>

      <!-- Manage Recruiters -->
      <section id="recruitersSection" class="hidden">
        <h2 class="text-2xl font-bold mb-4">Manage Recruiters</h2>
        <div class="overflow-x-auto bg-white shadow rounded">
          <table class="min-w-full divide-y divide-gray-200">
            <thead class="bg-gray-50"><tr>
              <th class="px-6 py-3">Company</th><th class="px-6 py-3">Recruiter</th><th class="px-6 py-3">Email</th>
              <th class="px-6 py-3">Status</th><th class="px-6 py-3">Actions</th></tr>
            </thead>
            <tbody id="recruitersTable" class="divide-y divide-gray-200"></tbody>
          </table>
        </div>
      </section>

      <!-- Applications -->
      <section id="applicationsSection" class="hidden">
        <h2 class="text-2xl font-bold mb-4">Student Applications</h2>
        <div class="overflow-x-auto bg-white shadow rounded">
          <table class="min-w-full divide-y divide-gray-200">
            <thead class="bg-gray-50"><tr>
              <th class="px-6 py-3">Student</th><th class="px-6 py-3">Job</th><th class="px-6 py-3">Company</th>
              <th class="px-6 py-3">Date</th><th class="px-6 py-3">Status</th></tr>
            </thead>
            <tbody id="applicationsTable" class="divide-y divide-gray-200"></tbody>
          </table>
        </div>
      </section>

      <!-- Jobs -->
      <section id="jobsSection" class="hidden">
        <h2 class="text-2xl font-bold mb-4">Jobs Posted</h2>
        <div class="overflow-x-auto bg-white shadow rounded">
          <table class="min-w-full divide-y divide-gray-200">
            <thead class="bg-gray-50"><tr>
              <th class="px-6 py-3">Company</th><th class="px-6 py-3">Title</th>
              <th class="px-6 py-3">Posted</th><th class="px-6 py-3">Deadline</th></tr>
            </thead>
            <tbody id="jobsTable" class="divide-y divide-gray-200"></tbody>
          </table>
        </div>
      </section>

      <!-- Notifications -->
      <section id="notificationsSection" class="hidden">
        <h2 class="text-2xl font-bold mb-4">Manage Notifications</h2>
        <form id="notificationForm" class="mb-6 flex gap-4">
          <input id="notificationInput" type="text" placeholder="Write a notification..." class="flex-1 border rounded px-4 py-2" required/>
          <button class="bg-blue-600 text-white px-4 py-2 rounded">Add</button>
        </form>
        <div class="overflow-x-auto bg-white shadow rounded">
          <table class="min-w-full divide-y divide-gray-200">
            <thead class="bg-gray-50"><tr><th class="px-6 py-3">Message</th><th class="px-6 py-3">Date</th></tr></thead>
            <tbody id="notificationsTable" class="divide-y divide-gray-200"></tbody>
          </table>
        </div>
      </section>

    </main>
  </div>
</div>

<!-- Firebase SDK -->
<script type="module">
  import { initializeApp } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-app.js";
  import { getAuth, signOut } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-auth.js";
  import { getFirestore, doc, onSnapshot, updateDoc, collection, query, where, addDoc, serverTimestamp } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-firestore.js";
  import { firebaseConfig, appId } from "./firebase-config.js";

  const app = initializeApp(firebaseConfig);
  const auth = getAuth(app);
  const db = getFirestore(app);

  // Sidebar toggle
  const sidebar = document.getElementById('sidebar');
  document.getElementById('openSidebar').addEventListener('click', () => sidebar.classList.remove('sidebar-hidden'));
  document.getElementById('closeSidebar').addEventListener('click', () => sidebar.classList.add('sidebar-hidden'));

  // Nav links
  const sections = {
    dashboardNav: 'dashboardSection',
    studentsNav: 'studentsSection',
    recruitersNav: 'recruitersSection',
    applicationsNav: 'applicationsSection',
    jobsNav: 'jobsSection',
    notificationsNav: 'notificationsSection',
  };
  Object.keys(sections).forEach(navId => {
    document.getElementById(navId).addEventListener('click', () => {
      Object.values(sections).forEach(secId => document.getElementById(secId).classList.add('hidden'));
      document.getElementById(sections[navId]).classList.remove('hidden');
      sidebar.classList.add('sidebar-hidden');
    });
  });

  // Listen counts
  const studentCountEl=document.getElementById("studentCount"), recruiterCountEl=document.getElementById("recruiterCount"), pendingCountEl=document.getElementById("pendingCount");
  onSnapshot(collection(db,"artifacts",appId,"users"),(qs)=>{let s=0,r=0,p=0;qs.forEach(d=>{const x=d.data();if(x.role==="student"){s++;if(x.approvalStatus==="pending")p++;}else if(x.role==="recruiter"){r++;if(x.approvalStatus==="pending")p++;}});studentCountEl.textContent=s;recruiterCountEl.textContent=r;pendingCountEl.textContent=p;});

  // Students
  const studentsTable=document.getElementById("studentsTable");
  onSnapshot(query(collection(db,"artifacts",appId,"users"),where("role","==","student")),(qs)=>{studentsTable.innerHTML="";qs.forEach(docSnap=>{const st=docSnap.data();const sc=st.approvalStatus==="approved"?"bg-green-100 text-green-800":st.approvalStatus==="pending"?"bg-yellow-100 text-yellow-800":"bg-red-100 text-red-800";const act=st.approvalStatus==="pending"?`<button onclick="updateStudentStatus('${docSnap.id}','approved')" class="approve-btn mr-2">Approve</button><button onclick="updateStudentStatus('${docSnap.id}','rejected')" class="reject-btn">Reject</button>`:"";studentsTable.innerHTML+=`<tr><td class="px-6 py-4">${st.name||"N/A"}</td><td class="px-6 py-4">${st.email||"N/A"}</td><td class="px-6 py-4">${st.createdAt?.toDate().toLocaleDateString()||"N/A"}</td><td class="px-6 py-4"><span class="status-badge ${sc}">${st.approvalStatus}</span></td><td class="px-6 py-4">${act}</td></tr>`;});});

  // Recruiters
  const recruitersTable=document.getElementById("recruitersTable");
  onSnapshot(query(collection(db,"artifacts",appId,"users"),where("role","==","recruiter")),(qs)=>{recruitersTable.innerHTML="";qs.forEach(docSnap=>{const rc=docSnap.data();const sc=rc.approvalStatus==="approved"?"bg-green-100 text-green-800":rc.approvalStatus==="pending"?"bg-yellow-100 text-yellow-800":"bg-red-100 text-red-800";const act=rc.approvalStatus==="pending"?`<button onclick="updateRecruiterStatus('${docSnap.id}','approved')" class="approve-btn mr-2">Approve</button><button onclick="updateRecruiterStatus('${docSnap.id}','rejected')" class="reject-btn">Reject</button>`:"";recruitersTable.innerHTML+=`<tr><td class="px-6 py-4">${rc.companyName||"N/A"}</td><td class="px-6 py-4">${rc.name||"N/A"}</td><td class="px-6 py-4">${rc.email||"N/A"}</td><td class="px-6 py-4"><span class="status-badge ${sc}">${rc.approvalStatus}</span></td><td class="px-6 py-4">${act}</td></tr>`;});});

  // Applications
  const applicationsTable=document.getElementById("applicationsTable");
  onSnapshot(collection(db,"artifacts",appId,"applications"),(qs)=>{applicationsTable.innerHTML="";qs.forEach(d=>{const ap=d.data();applicationsTable.innerHTML+=`<tr><td class="px-6 py-4">${ap.studentName||"N/A"}</td><td class="px-6 py-4">${ap.jobTitle||"N/A"}</td><td class="px-6 py-4">${ap.companyName||"N/A"}</td><td class="px-6 py-4">${ap.appliedAt?.toDate().toLocaleDateString()||"N/A"}</td><td class="px-6 py-4">${ap.status||"N/A"}</td></tr>`;});});

  // Jobs
  const jobsTable=document.getElementById("jobsTable");
  onSnapshot(collection(db,"artifacts",appId,"jobs"),(qs)=>{jobsTable.innerHTML="";qs.forEach(d=>{const jb=d.data();jobsTable.innerHTML+=`<tr><td class="px-6 py-4">${jb.companyName||"N/A"}</td><td class="px-6 py-4">${jb.title||"N/A"}</td><td class="px-6 py-4">${jb.postedAt?.toDate().toLocaleDateString()||"N/A"}</td><td class="px-6 py-4">${jb.deadline?.toDate().toLocaleDateString()||"N/A"}</td></tr>`;});});

  // Notifications
  const notificationsTable=document.getElementById("notificationsTable");
  onSnapshot(collection(db,"artifacts",appId,"notifications"),(qs)=>{notificationsTable.innerHTML="";qs.forEach(d=>{const n=d.data();notificationsTable.innerHTML+=`<tr><td class="px-6 py-4">${n.message}</td><td class="px-6 py-4">${n.createdAt?.toDate().toLocaleString()||"N/A"}</td></tr>`;});});

  // Manual add notification
  document.getElementById('notificationForm').addEventListener('submit',async(e)=>{e.preventDefault();const msg=document.getElementById('notificationInput').value;await addDoc(collection(db,"artifacts",appId,"notifications"),{message:msg,createdAt:serverTimestamp()});document.getElementById('notificationInput').value="";});

  // Auto push notification
  async function pushNotification(msg){await addDoc(collection(db,"artifacts",appId,"notifications"),{message:msg,createdAt:serverTimestamp()});}

  window.updateStudentStatus=async(id,status)=>{await updateDoc(doc(db,"artifacts",appId,"users",id),{approvalStatus:status});await pushNotification(`Student ${status}: ${id}`);}
  window.updateRecruiterStatus=async(id,status)=>{await updateDoc(doc(db,"artifacts",appId,"users",id),{approvalStatus:status});await pushNotification(`Recruiter ${status}: ${id}`);}

  // Logout
  document.getElementById('logoutNav').addEventListener('click',async()=>{await signOut(auth);location.href="superadmin-login.html";});
</script>
</body>
</html>
