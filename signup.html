<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Customer Registration | KsheerFresh</title>

  <!-- Firebase (compat builds so we can use inline JS easily) -->
  <script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-app-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-auth-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-firestore-compat.js"></script>

  <!-- Your local config file (MUST be in the same folder as this HTML) -->
  <script src="./firebase-config.js"></script>

  <style>
    :root { --brand:#0ea5e9; --bg:#f7fafc; --card:#ffffff; --text:#1f2937; }
    body { margin:0; font-family: system-ui, -apple-system, Segoe UI, Roboto, Arial, sans-serif; background:var(--bg); color:var(--text);}
    .wrapper { max-width: 520px; margin: 40px auto; padding: 0 16px; }
    .card { background:var(--card); border-radius:14px; box-shadow:0 8px 24px rgba(0,0,0,.08); padding:24px; }
    h1 { margin:0 0 12px; font-size: 24px; }
    p.sub { margin:0 0 20px; color:#6b7280; font-size:14px; }
    .row { display:flex; gap:12px; }
    .row > .field { flex:1; }
    .field { margin-bottom:12px; }
    label { display:block; font-size: 13px; margin-bottom:6px; color:#374151; }
    input, textarea {
      width:100%; padding:12px 12px; border:1px solid #e5e7eb; border-radius:10px; font-size:14px; outline:none;
      background:#fff;
    }
    textarea { min-height:90px; resize:vertical; }
    input:focus, textarea:focus { border-color: var(--brand); box-shadow:0 0 0 3px rgba(14,165,233,.15); }
    button {
      width:100%; padding:12px 16px; border:none; border-radius:12px; background:var(--brand); color:white; font-weight:600; cursor:pointer;
      transition:transform .06s ease, opacity .2s ease;
    }
    button:disabled { opacity:.6; cursor:not-allowed; }
    .msg { margin-top:12px; font-size:14px; }
    .msg.error { color:#dc2626; }
    .msg.success { color:#16a34a; }
    .note { margin-top:10px; font-size:12px; color:#6b7280; text-align:center; }
  </style>
</head>
<body>
  <div class="wrapper">
    <div class="card">
      <h1>Create your customer account</h1>
      <p class="sub">Sign up to start daily fresh milk deliveries.</p>

      <form id="registerForm" novalidate>
        <div class="row">
          <div class="field">
            <label for="fullName">Full name</label>
            <input id="fullName" type="text" placeholder="e.g., Ananya Sharma" required />
          </div>
          <div class="field">
            <label for="phone">Phone</label>
            <input id="phone" type="tel" placeholder="10-digit mobile" />
          </div>
        </div>

        <div class="field">
          <label for="email">Email</label>
          <input id="email" type="email" placeholder="you@example.com" required />
        </div>

        <div class="field">
          <label for="password">Password</label>
          <input id="password" type="password" placeholder="Min 6 characters" required />
        </div>

        <div class="field">
          <label for="address">Delivery address</label>
          <textarea id="address" placeholder="House/Flat, Street, Area, City, Pincode"></textarea>
        </div>

        <button id="submitBtn" type="submit">Create account</button>
        <div id="formMsg" class="msg"></div>
        <p class="note">Already have an account? <a href="login.html">Log in</a></p>
      </form>
    </div>
  </div>

  <script>
    // This page expects firebase-config.js to have already run:
    // firebase.initializeApp(firebaseConfig); const auth = firebase.auth(); const db = firebase.firestore();

    const form = document.getElementById('registerForm');
    const btn  = document.getElementById('submitBtn');
    const msg  = document.getElementById('formMsg');

    form.addEventListener('submit', async (e) => {
      e.preventDefault();
      msg.textContent = '';
      msg.className = 'msg';

      const name = document.getElementById('fullName').value.trim();
      const phone = document.getElementById('phone').value.trim();
      const email = document.getElementById('email').value.trim();
      const password = document.getElementById('password').value;
      const address = document.getElementById('address').value.trim();

      // Basic validation (lightweight)
      if (!name)   return showError('Please enter your full name.');
      if (!email)  return showError('Please enter a valid email.');
      if (password.length < 6) return showError('Password must be at least 6 characters.');

      btn.disabled = true;

      try {
        // 1) Create Auth user
        const cred = await auth.createUserWithEmailAndPassword(email, password);
        const uid = cred.user.uid;

        // 2) Create Firestore profile
        await db.collection('users').doc(uid).set({
          uid,
          name,
          phone,
          email,
          address,
          role: 'user',              // customer role
          createdAt: firebase.firestore.FieldValue.serverTimestamp()
        });

        showSuccess('Account created! Redirecting to loginâ€¦');
        // Optional: sign out immediately (so they log in via login page)
        await auth.signOut();

        setTimeout(() => { window.location.href = 'login.html'; }, 1200);
      } catch (err) {
        console.error(err);
        if (err && err.code === 'auth/email-already-in-use') {
          showError('This email is already registered. Try logging in.');
        } else if (err && err.code === 'auth/invalid-email') {
          showError('Invalid email address.');
        } else {
          showError(err.message || 'Something went wrong. Please try again.');
        }
      } finally {
        btn.disabled = false;
      }
    });

    function showError(text) {
      msg.textContent = text;
      msg.className = 'msg error';
    }
    function showSuccess(text) {
      msg.textContent = text;
      msg.className = 'msg success';
    }
  </script>
</body>
</html>
